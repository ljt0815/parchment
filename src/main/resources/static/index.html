<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>slider</title>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        .animation_canvas  {
            overflow:hidden;
            position:relative;
            width:600px; height:400px;
        }

        /* Slider Panel */
        .slider_panel { width:4200px; position:relative; left:-600px;}
        .slider_image { float:left; width:600px; height:400px;}

        /* Control Panel */
        .control_panel  {
            position:absolute;
            bottom:15px;
            left:255px;
            /* overflow:hidden;  */
            color:white;
        }

        .caption_panel {
            position:absolute;
            top : 5px;
            left: 200px;
            text-align: center;
        }

        .caption {
            display: none;
            background-color: black;
            color: white;
            width: 200px;
        }

        .dot{
            font-size:30px;
            cursor:pointer;
        }

        .fa {
            font-size : 20px;
        }

        .arrow.fa {
            font-size : 100px;
        }

        .prev {
            position:absolute;
            width: 30px;
            height: 100%;
            color: white;
            cursor: pointer;
        }
        .next {
            position:absolute;
            right: 0px;
            width: 30px;
            height: 100%;
            color: white;
            cursor: pointer;
        }
        #rightArrow {
            /* background-color: yellow; */
            position: absolute;
            top: 180px;
            right: 10px;
        }
        #leftArrow {
            position: absolute;
            top: 180px;
            left: 10px;
        }
    </style>
    <script>
        $(document).ready(function () {
            // 슬라이더를 움직여주는 함수
            function moveSlider(index){
                var willMoveLeft = -((index) * 600);

                //            slider_image 순서
                // {5번clone, 1번, 2번, 3번, 4번, 5번, 1번clone}
                //    0    ,   1 ,  2,  3,    4,   5,     6

                if (index == 6) { // 5번 사진 -> 1번clone 사진 이라면
                    $('.slider_panel').clearQueue(); // 하던 애니메이션은 멈추고
                    $('.slider_panel').css('left', '0px'); // 인덱스 0 (5번째 사진의 clone) 위치로 바꾸고
                    willMoveLeft = -600;
                    $('.slider_panel').animate({ left: willMoveLeft }, 'slow'); //인덱스 1 (1번 사진)의 위치로 애니메이션한다.


                    // 아래 display 속성값 조정을 위한 index 수정
                    index = 1;
                }
                else if (index == 0) { // 1번 사진 -> 5번 사진 이라면
                    $('.slider_panel').clearQueue();
                    $('.slider_panel').css('left', '-3600px'); // 인덱스 6 (1번 사진의 clone) 위치로 바꾸고
                    willMoveLeft = -3000; // 5번사진의 위치
                    $('.slider_panel').animate({ left: willMoveLeft }, 'slow'); //인덱스 5 (5번 사진)의 위치로 애니메이션한다.


                    // 아래 display 속성값 조정을 위한 index 수정
                    index = 5;
                }
                else
                    $('.slider_panel').animate({ left: willMoveLeft }, 'slow');

                $('.slider_image').each(function(j){
                    if (index == j)
                        $(this).attr("display", 'y');
                    else
                        $(this).removeAttr("display");
                });
            };
            // indicator모양을 변경하는 함수
            function changeCircle(argIndex){
                // clone때문에 인디케이터와 사진의 인덱스 오차가 생겨 값을 -1씩 조정해줬다.
                argIndex = (argIndex - 1) % 5;
                if (argIndex == -1)
                    argIndex = 4;
                $(".dot").each(function(index) {
                    if (index != argIndex) {
                        $(this).children().removeClass('fa-circle');
                        $(this).children().addClass('fa-circle-thin')
                    } else if (index == argIndex) {
                        $(this).children().removeClass('fa-circle-thin');
                        $(this).children().addClass('fa-circle')
                    }
                });
            }
            // 현재 픽셀 위치를 반환하는 함수
            function currentPixel() {
                let ret = 0;
                $(".slider_image").each(function(idx) {
                    if ($(this).attr('display') == 'y')
                        ret = idx;
                });
                return ret;
            }
            // 앞으로 한칸 가는 함수
            function moveNext() {
                let idx = currentPixel() + 1;
                moveSlider(idx);
                changeCircle(idx);
                captionDisplay(idx);
            }
            // 뒤로 한칸 가는 함수
            function movePrev() {
                let idx = currentPixel() - 1;
                moveSlider(idx);
                changeCircle(idx);
                captionDisplay(idx);
            }
            // 인터벌을 리셋 시키는 함수
            function intervalReset() {
                time = 0;
            }

            function randomAnimation() {
                let index = Math.floor(Math.random() * animations.length);
                let ret = animations[index];
                animations.splice(index, 1);

                return "animate__" + ret;
            }

            function captionDisplay(argIndex) {
                argIndex = (argIndex - 1) % 5;
                if (argIndex == -1)
                    argIndex = 4;
                $(".caption").each(function(index){
                    if (index != argIndex) {
                        $(this).css('display', 'none');
                    } else {
                        $(this).css('display', 'block');
                    }
                })
            }

            $(".dot").click(function(){
                // 인디케이터와 사진인덱스 차이때문에 값을 조정
                // (clone때문에 현재 클릭된 인디케이터의 인덱스보다 1칸 다음의 사진을 보여줘야한다)
                moveSlider($(this).index() + 1);
                changeCircle($(this).index() + 1);
                captionDisplay($(this).index() + 1);
                intervalReset(); // 클릭으로 이동시 다시 3초 기다리게
            });
            $(".prev").click(function(){
                movePrev();
                intervalReset();
            });
            $(".next").click(function(){
                moveNext();
                intervalReset();
            });
            // 마우스 올라갈시 인터벌 멈추기
            $(".animation_canvas").mouseenter(function() {
                ispaused = true;
            });
            // 마우스 빠져나올시 인터벌 시작
            $(".animation_canvas").mouseleave(function() {
                ispaused = false;
            });

            // 3초마다 moveNext
            let time = 0;
            let ispaused = false;
            let myInterval = setInterval(function(){
                if (!ispaused) {
                    time++;
                    if (time == 3) {
                        moveNext();
                        intervalReset();
                    }
                }
            }, 1000);
            // 애니메이션 배열 전역변수
            let animations = [
                'bounce', 'flash', 'pulse', 'rubberBand',
                'backInDown', 'shakeY', 'zoomInDown',
                'lightSpeedInRight', 'rotateIn', 'hinge'
            ];
            // 애니메이션 랜덤 초기화
            $(".caption").each(function(index){
                let ani = randomAnimation();
                console.log(ani);
                $(this).addClass(ani);
            });

        });
    </script>
</head>
<body>
<div class="animation_canvas">
    <div class="slider_panel">
        <img src="https://s.fotorama.io/5.jpg" class="slider_image">
        <img src="https://s.fotorama.io/1.jpg" class="slider_image" display="y">
        <img src="https://s.fotorama.io/2.jpg" class="slider_image">
        <img src="https://s.fotorama.io/3.jpg" class="slider_image">
        <img src="https://s.fotorama.io/4.jpg" class="slider_image">
        <img src="https://s.fotorama.io/5.jpg" class="slider_image">
        <img src="https://s.fotorama.io/1.jpg" class="slider_image">
    </div>

    <div class="control_panel" style="text-align:center">
        <span class="dot"><i class="fa fa-circle" aria-hidden="true"></i></span>
        <span class="dot"><i class="fa fa-circle-thin" aria-hidden="true"></i></span>
        <span class="dot"><i class="fa fa-circle-thin" aria-hidden="true"></i></span>
        <span class="dot"><i class="fa fa-circle-thin" aria-hidden="true"></i></span>
        <span class="dot"><i class="fa fa-circle-thin" aria-hidden="true"></i></span>
    </div>

    <div class="caption_panel">
        <span class="caption animate__animated" style="display: block">안개낀 우거진 갈대숲</span>
        <span class="caption animate__animated">이끼낀 돌산맥</span>
        <span class="caption animate__animated">날흐린 허허벌판 산기슭</span>
        <span class="caption animate__animated">뙤약볕 초록빛 산맥</span>
        <span class="caption animate__animated">도로가 깔린 산맥</span>
    </div>

    <div class="prev">
        <span class="arrow"><i id="leftArrow" class="fa fa-caret-left" aria-hidden="true"></i></span>
    </div>

    <div class="next">
        <span class="arrow"><i id="rightArrow" class="fa fa-caret-right" aria-hidden="true"></i></span>
    </div>
</div>
</body>
</html>